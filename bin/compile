#!/usr/bin/env bash
#
# usage: bin/compile <build-dir> <cache-dir> <env-dir>
# See https://devcenter.heroku.com/articles/buildpack-api#bin-compile
#

set -eo pipefail
set -x

mkdir -p "$1" "$2"
build_dir=$(cd "$1/" && pwd)
cache_dir=$(cd "$2/" && pwd)
env_dir="${3}"
buildpack_dir=$(cd "$(dirname $0)/.." && pwd)

ls -a -R ../..

mkdir -p ${build_dir}/bin

cat > ${build_dir}/bin/go-pre-compile <<<EOF
#!/usr/bin/env bash
set -eo pipefail
set -x
go install -v github.com/sqreen/go-agent/sdk/sqreen-instrumentation-tool
$GOBIN/sqreen-instrumentation-tool -h
EOF

chmod +x ${build_dir}/bin/go-pre-compile
